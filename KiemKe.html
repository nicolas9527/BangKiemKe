<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bảng Kiểm Kê</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, Arial;
    background: linear-gradient(180deg, #e8f5e9, #c8e6c9);
    padding: 12px;
}

.box {
    background: #fff;
    border-radius: 18px;
    padding: 16px;
    box-shadow: 0 8px 22px rgba(0,0,0,0.08);
}

/* CONTROL BAR */
.control-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(90deg, #e8f5e9, #c8e6c9);
    padding: 10px 14px;
    border-radius: 16px;
    margin-bottom: 16px;
    box-shadow: inset 0 0 0 1px #a5d6a7;
}

.ctrl-btn {
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all .15s ease;
}

.ctrl-btn.sub {
    width: 46px;
    height: 46px;
    font-size: 22px;
    background: #a5d6a7;
    color: #1b5e20;
    box-shadow: 0 4px 10px rgba(76,175,80,.35);
}

.ctrl-btn.main {
    width: 60px;
    height: 60px;
    font-size: 26px;
    background: linear-gradient(180deg, #43a047, #2e7d32);
    color: #fff;
    box-shadow: 0 6px 16px rgba(46,125,50,.55);
}

.ctrl-btn:active {
    transform: scale(.92);
}

/* ROW */
.row {
    display: flex;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px dashed #c8e6c9;
}

.row:last-child { border-bottom: none; }

.row.total-row {
    border-top: 2px solid #2e7d32;
    margin-top: 6px;
}

.name {
    flex: 2;
    font-weight: 600;
    color: #1b5e20;
}

.input {
    flex: 3;
    display: flex;
    gap: 6px;
}

input {
    width: 100%;
    max-width: 100px;
    padding: 8px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #a5d6a7;
    background: #f1f8e9;
}

.plus {
    width: 38px;
    height: 38px;
    font-size: 18px;
    border-radius: 8px;
    border: none;
    background: #43a047;
    color: #fff;
}

.total {
    flex: 2;
    text-align: right;
    font-weight: bold;
    font-size: 17px;
    color: #1b5e20;
}

.grand {
    font-size: 20px;
}

.status {
    font-weight: bold;
    font-size: 17px;
    text-align: right;
}

.thua { color: #2e7d32; }
.thieu { color: #c62828; }
.du { color: #1565c0; }
</style>
</head>

<body>

<div class="box">

<!-- CONTROL -->
<div class="control-bar">
    <button class="ctrl-btn sub" onclick="undo()">⟲</button>
    <button class="ctrl-btn main" onclick="resetAll()">⟲⟲</button>
    <button class="ctrl-btn sub" onclick="redo()">⟳</button>
</div>

<!-- DỮ LIỆU -->
<div class="row">
    <div class="name">Lon (x1)</div>
    <div class="input">
        <input type="number" id="lon">
        <button class="plus" onclick="add('lon',1)">+</button>
    </div>
    <div class="total" id="total_lon">0</div>
</div>

<div class="row">
    <div class="name">Lốc (x6)</div>
    <div class="input">
        <input type="number" id="loc6">
        <button class="plus" onclick="add('loc6',6)">+</button>
    </div>
    <div class="total" id="total_loc6">0</div>
</div>

<div class="row">
    <div class="name">Lốc (x4)</div>
    <div class="input">
        <input type="number" id="loc4">
        <button class="plus" onclick="add('loc4',4)">+</button>
    </div>
    <div class="total" id="total_loc4">0</div>
</div>

<div class="row">
    <div class="name">Thùng (x24)</div>
    <div class="input">
        <input type="number" id="thung24">
        <button class="plus" onclick="add('thung24',24)">+</button>
    </div>
    <div class="total" id="total_thung24">0</div>
</div>

<div class="row">
    <div class="name">Thùng (x48)</div>
    <div class="input">
        <input type="number" id="thung48">
        <button class="plus" onclick="add('thung48',48)">+</button>
    </div>
    <div class="total" id="total_thung48">0</div>
</div>

<!-- TỔNG -->
<div class="row total-row">
    <div class="name grand">TỔNG</div>
    <div></div>
    <div class="total grand" id="grand_total">0</div>
</div>

<!-- TỒN -->
<div class="row">
    <div class="name">Tồn hệ thống</div>
    <div class="input">
        <input type="number" id="system_stock" oninput="compare()">
    </div>
    <div></div>
</div>

<!-- CHÊNH LỆCH -->
<div class="row">
    <div class="name">Chênh lệch</div>
    <div></div>
    <div class="status" id="difference">—</div>
</div>

</div>

<script>
let totals = { lon:0, loc6:0, loc4:0, thung24:0, thung48:0 };
let history = [], future = [];

function snapshot() {
    history.push(JSON.stringify(totals));
    future = [];
}

function restore(state) {
    totals = JSON.parse(state);
    for (let k in totals) {
        document.getElementById('total_' + k).innerText = totals[k];
    }
    updateGrandTotal();
}

function add(type, unit) {
    let input = document.getElementById(type);
    let qty = parseInt(input.value) || 0;
    if (!qty) return;

    snapshot();
    totals[type] += qty * unit;
    document.getElementById('total_' + type).innerText = totals[type];
    input.value = '';
    updateGrandTotal();
}

function updateGrandTotal() {
    let sum = 0;
    for (let k in totals) sum += totals[k];
    document.getElementById('grand_total').innerText = sum;
    compare();
}

function compare() {
    let system = parseInt(system_stock.value);
    let total = parseInt(grand_total.innerText);
    let d = difference;

    if (isNaN(system)) {
        d.innerText = '—';
        d.className = 'status';
        return;
    }

    let diff = total - system;
    if (diff > 0) {
        d.innerText = `Thừa ${diff}`;
        d.className = 'status thua';
    } else if (diff < 0) {
        d.innerText = `Thiếu ${-diff}`;
        d.className = 'status thieu';
    } else {
        d.innerText = 'Đủ';
        d.className = 'status du';
    }
}

function resetAll() {
    history = [];
    future = [];
    for (let k in totals) totals[k] = 0;
    document.querySelectorAll('.total').forEach(e => e.innerText = 0);
    system_stock.value = '';
    difference.innerText = '—';
}

function undo() {
    if (!history.length) return;
    future.push(JSON.stringify(totals));
    restore(history.pop());
}

function redo() {
    if (!future.length) return;
    history.push(JSON.stringify(totals));
    restore(future.pop());
}
</script>

</body>
</html>
